"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.missingHandler = missingHandler;

var _i18next = _interopRequireDefault(require("i18next"));

var utils = _interopRequireWildcard(require("./utils"));

var missings = {};

function log() {
  _i18next["default"].services.logger.log('missing resources: \n' + JSON.stringify(missings, null, 2));
}

var debouncedLog = utils.debounce(log, 2000);

function missingHandler(lngs, namespace, key, res) {
  if (typeof lngs === 'string') lngs = [lngs];
  if (!lngs) lngs = [];
  lngs.forEach(function (lng) {
    utils.setPath(missings, [lng, namespace, key], res);
    debouncedLog();
  });

  if (_i18next["default"].services.backendConnector && _i18next["default"].services.backendConnector.saveMissing) {
    _i18next["default"].services.backendConnector.saveMissing(lngs, namespace, key, res);
  }
}