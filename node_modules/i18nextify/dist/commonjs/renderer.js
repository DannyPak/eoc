"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = _default;

var _vdomVirtualize = _interopRequireDefault(require("vdom-virtualize"));

var _diff = _interopRequireDefault(require("virtual-dom/diff"));

var _patch = _interopRequireDefault(require("virtual-dom/patch"));

var _udc = _interopRequireDefault(require("udc"));

var _Instrument = _interopRequireDefault(require("./Instrument"));

var _localize = _interopRequireDefault(require("./localize"));

var utils = _interopRequireWildcard(require("./utils"));

var _i18next = _interopRequireDefault(require("i18next"));

function createVdom(node) {
  var virtualizeTime = new _Instrument["default"]();
  virtualizeTime.start();
  var vNode = (0, _vdomVirtualize["default"])(node);

  _i18next["default"].services.logger.log("virtualization took: ".concat(virtualizeTime.end(), "ms"));

  return vNode;
}

function _default(root, observer) {
  var ret = {};

  ret.render = function render(retranslate) {
    var newNode = createVdom(root);
    var localized = (0, _localize["default"])((0, _udc["default"])(newNode), retranslate);
    var patches = (0, _diff["default"])(newNode, localized);
    if (patches['0']) observer.reset(); // reset observer if having patches

    root = (0, _patch["default"])(root, patches);
  };

  ret.debouncedRender = utils.debounce(ret.render, 200);
  return ret;
}